Shaiya Multi-Tab Configuration & Lua Editor

A unified, dark-themed GUI application for editing all major Shaiya configuration files and Lua scripts in one place. Built with Python 3 and Tkinter/ttk, this tool provides:

- EditItemCreate: Edit ItemCreate.ini files with section and row management, inline notes, and ID/quantity lookup.
- EditMobCreate: Manage MobCreateSet and MobCreateGroup sections with table-based editing of CountMobs, Percent, SetMobFix, and DisableMap parameters.
- EditMapCreate: Edit map.ini files (map settings and weather settings) using dropdowns, entry fields, and a general key/value view.
- EditObelisk: Browse and edit Obelisk configurations (Zones → Obelisks → Mobs), BothMobs, and Portals through a collapsible treeview and context-sensitive forms.
- EditChaoticSquare: Edit ChaoticSquare (ItemSynthesis) sections with 24-column material lists, single-value fields, and section management.
- EditLua: Explore Lua scripts in a selected folder, view a collapsible list of detected functions, insert Shaiya-specific function skeletons, and enjoy full syntax highlighting (Lua + Shaiya keywords).

---

Features

1. Dark-Theme Multi-Tab Interface

- All editors share a consistent dark theme with clear foreground text.
- Tabs for each configuration type, allowing seamless switching between:
  - EditItemCreate
  - EditMobCreate
  - EditMapCreate
  - EditObelisk
  - EditChaoticSquare
  - EditLua

2. EditItemCreate (INI Editor)

- Load and parse any *.ini or *.txt file following the ItemCreate format.
- Display sections ([ItemCreate_X], [RandomItemsCreate_Y]) in a listbox, sorted by type and index.
- Add or remove sections (C-Section vs. R-Section) with autogenerated naming (ItemCreate_1, RandomItemsCreate_1, etc.).
- Within each section, view and edit rows of ID	Quantity // Note.
  - Inline editing of Grade (ID), Rate (Quantity), and Note.
  - Delete rows (ensuring at least one row remains).
  - Add blank rows and begin editing immediately.
- Search by numeric ID across all sections—selects and scrolls to the first match.
- Save changes back to the same file or “Save As” a new INI.

3. EditMobCreate (MobCreateSet / MobCreateGroup Editor)

- Parse MobCreate.ini files containing [MobCreateSet_X] and [MobCreateGroup_Y] sections.
- MobCreateSet:
  - Display a table of (CountMobs, Percent) pairs with a “delete” column (❌). Ensures at least one row remains.
  - Edit CountMobs or Percent inline via double-click.
  - “DisableMap” field to specify a comma-separated list of map IDs to disable.
  - “Add Set” button creates a new MobCreateSet_N with a default row (N, 100).
  - Delete an entire set (with confirmation), cleaning up any unused groups automatically.
- MobCreateGroup:
  - For each CountMobs value present in the selected set:
    - Display (SetMobMin, SetMobMax, SetMobRangeMin, SetMobRangeMax, SetMobFix) for that GroupID.
    - Edit any of those five fields inline (including SetMobFix, which can be a comma-separated list of integers).
  - Automatically create a new group entry when a CountMobs value first appears.
- Load and save the entire MobCreate.ini file structure, preserving correct ordering and empty sections.

4. EditMapCreate (Map.ini & Weather Editor)

- Load any map.ini file (or an INI with map/weather sections).
- Display all existing sections in a listbox.
- General View:
  - Show every key/value pair in a Treeview table. Double-click to edit a value.
- Map Settings (in a separate panel):
  - GUI controls for:
    - MapType (F / C / D / G)
    - MapName
    - RebirthMapPos, RebirthMapPos1, RebirthMapPos2 (comma-separated numeric triples)
    - MapCurse (four-value tuple: active(0/1), id_mal, param0, param1)
    - WarType (P = PvP, N = None)
    - CreateType (P = Party, A = Random, G = Guild)
    - CreateMinUser, EnterMaxUser, ExpireTime, GateKeeperLvMin, GateKeeperLvMax
  - “Save Map” button writes only those map-related keys back into the current section.
  - Detailed description panel on the right explaining valid values and examples.
- Weather Settings (another panel):
  - Controls for:
    - WeatherState (0: Clear, 1: Light Rain, 2: Rain, 3: Snow)
    - WeatherRate, WeatherPower, WeatherDelay, WeatherNoneDelay
  - “Save Weather” button writes only those keys back into the current section.
  - Description panel with explanations for each weather parameter.
- Changing between General, Map, and Weather views via a dropdown menu.

5. EditObelisk (Obelisk / BothMobs / Portals Editor)

- Load any Shaiya-formatted Obelisk text file (*.ini or *.txt):
  - Zones: [zone_XX] sections representing distinct zones.
  - Obelisks: [Obelisk_XXX] = (x,y,z),(mobNeutral,mobLight,mobFury),defaultFaction
    - Under each Obelisk, zero or more [Mob] = (x,y,z,radius),(mobNeutral,mobLight,mobFury),count entries.
  - BothMobs: [bothmob_NNN, (mapNo,changeCount,respawn,(portalMap,portalID))] = (x,y,z),(idA,idB)
    - Under each BothMob, child Mob entries or Item Drop entries.
  - Portals: [Portal_NNN, (mapNo,portalID)]
    - Child lines [light] = (map,Obelisk),(map,Obelisk),…
    - Child lines [fury] = (map,Obelisk),(map,Obelisk),…
- Populate a single ttk.Treeview with nodes:
  - Zones → Obelisks → Mobs
  - BothMobs → Child Mobs + ItemDrops
  - Portals → light entries + fury entries
- When a node is selected, display a form on the right:
  - Zone form: Add or delete the entire zone.
  - Obelisk form: Edit position (x, y, z), mob IDs (Neutral, Light, Fury), defaultFaction. Add/delete Obelisk. List and double-click to edit its Mobs.
  - Mob form: Edit position, radius, mob IDs, count. Save/delete a specific Mob under an Obelisk.
  - BothMob form: Edit parameters (mapNo, changeCount, respawn, (portalMap,portalID)), boss position (x,y,z), boss IDs (idA,idB). Add/delete BothMob. Add child Mobs or ItemDrops (each with position, radius, IDs, count).
  - Portal form: Edit (mapNo, portalID), then for each light/fury entry edit (map, Obelisk). Add/delete Portal. Add/delete individual light/fury entries.
- Automatic re-generation of the file text on “Save”:
  - Rebuild every [zone_…], Obelisk line, Mob lines, BothMob lines (including ItemDrop sections if present), Portal headers and [light]/[fury] entries, preserving the exact Shaiya file syntax.

6. EditChaoticSquare (ItemSynthesis Editor)

- Load any text-based ChaoticSquare or ItemSynthesis file with sections like [ItemSynthesis_0], [ItemSynthesis_1], …
- Maintain an ordered dictionary of sections; each section has the following fields:
  - ItemID, SuccessRate (single-value entries)
  - MaterialType, MaterialTypeID, MaterialCount (each a comma-separated list of 24 values)
  - CreateType, CreateTypeID, CreateCount (single values)
- UI layout:
  - Left: Listbox of all ItemSynthesis_X sections. Select to load that section’s data.
  - Right: Scrollable detail pane with:
    - Entry fields for single-value keys (ItemID, SuccessRate, CreateType, CreateTypeID, CreateCount).
    - A 24-column row of Entry widgets for each “list” field (MaterialType, MaterialTypeID, MaterialCount).
  - Buttons:
    - Load File: Open a file and parse all sections.
    - Save: Write back changes to the same file.
    - Add Section: Insert a new ItemSynthesis_N with default values (0 for scalars, "0,0,…,0" for lists) and reindex all sections sequentially.
    - Delete Section: Remove the selected section and reindex all remaining sections (ItemSynthesis_0, ItemSynthesis_1, …).
- Ensures that each section always has exactly 9 fields: 3 single-value and 3 lists of length 24, plus 3 other single values.

7. EditLua (Lua Explorer & Shaiya Function Inserter)

- Browse a folder containing .lua files:
  - Listbox on the left shows all .lua files sorted by name.
  - Double-click any file to load its content (UTF-8 or fallback to Latin-1).
- Middle pane (vertical split):
  - Top: A ttk.Treeview of detected root-level functions. Columns: Signature | StartLine | EndLine | ❌.
    - Detects any line matching function <name>(…), then finds the matching end by counting nested blocks (function, if…then, while…do, for…do, repeat) until depth returns to 0.
    - Builds a dictionary self.functions["sig_start_end"] = [start, end, isFolded].
    - The last column (❌) lets you delete the entire function (and the preceding separator if present).
    - Clicking on any row toggles folding/unfolding:
      - If folded, the range from the separator line (if it exists) to the end is tagged folded (elide=True).
      - If unfolded, remove that tag and select the function’s first line.
  - Bottom: A tk.Text editor with gutter (line numbers) on the right edge:
    - Syntax highlighting:
      - Lua keywords (function, end, if, for, etc.) → color tag keyword.
      - Shaiya-specific keywords (on_login, on_attackable, spawn_mob, etc.) → color tag shaiya.
      - Numeric literals → number.
      - Strings → string.
      - Comments (-- …) → comment.
    - Auto-indent: pressing Enter replicates the current line’s leading whitespace.
    - Folding tag configuration: editor_text.tag_configure("folded", elide=True).
- Right pane (“Add Function”):
  - Listbox of all Shaiya function signatures, grouped by episode:
    - Episode 1: on_login(dwTime, dwCharID), on_enter_map(dwTime, dwMapID), on_item_effect(dwTime, dwCharID, dwItemID)
    - Episode 2: on_can_recreate(dwTime, dwCharID), on_can_equip(dwTime, dwCharID, dwItemID), on_attackable(dwTime, dwCharID)
    - Episode 3: on_attacked(dwTime, dwCharID), on_return_home(dwTime, dwAttackedCount), on_normal_reset(dwTime)
    - Episode 4: on_death(dwTime, dwAttackedCount), on_move_end(dwTime), while_combat(dwTime, dwHPPercent, dwAttackedCount)
  - Double-clicking any signature inserts:
    -- //////////////////////////////////////////////////////////////////
    function <signature>
        -- TODO : implement
    end

    then re-runs function detection and re-folds all blocks.
- Gutter (line numbers) always synchronized with the main editor.
- Clicking inside the editor selects the corresponding function in the top Treeview.

---

Prerequisites

- Python 3.7+ (tested on 3.8, 3.9, 3.10)
- Tkinter (usually bundled with Python; on Linux, install python3-tk)
- No external dependencies beyond the Python standard library (e.g., no PyPI packages required).

---

Installation

1. Clone the repository:
   git clone https://github.com/<your-username>/ShaiyaEditor.git
   cd ShaiyaEditor

2. (Optional) Create a virtual environment:
   python3 -m venv venv
   source venv/bin/activate   # macOS/Linux
   # or
   venv\Scripts\activate.bat  # Windows

3. Install prerequisites (if any future dependencies are added, list them in requirements.txt):
   pip install -r requirements.txt

4. Run the application:
   python main.py

---

Usage

1. Launch main.py. A window with a dark-themed notebook appears.
2. Select a tab for the file type you want to edit:
   - EditItemCreate → Open or save ItemCreate_X.ini files.
   - EditMobCreate → Load a MobCreate.ini, edit sets/groups, then save.
   - EditMapCreate → Load any INI containing map/weather data, modify, then save.
   - EditObelisk → Load an Obelisk/Zone text file, edit zones/obelisks/mobs, then save.
   - EditChaoticSquare → Load a ChaoticSquare/ItemSynthesis file, modify sections, then save.
   - EditLua → Select a folder of .lua scripts, browse and fold functions, insert Shaiya function templates, edit, then save.
3. Follow on-screen buttons and tooltips:
   - Add / Delete sections or rows.
   - Double-click cells to edit inline.
   - Use “Save” or “Save As” as appropriate.
   - In EditLua, click the ❌ column to remove a function, or click its row (signature) to fold/unfold.
   - In EditObelisk, navigate the tree on the left, and fill out forms on the right.
4. Confirm save dialogs or confirmations when deleting sections.

---

File Structure

ShaiyaEditor/
├── LICENSE

├── README.md

├── main.py

├── editor_itemcreate.py      # Contains IniEditorFrame

├── editor_mobcreate.py       # Contains MobCreateFrame & InlineEditor

├── editor_map.py             # Contains MapIniEditorFrame

├── editor_obelisk.py         # Contains ObeliskEditorFrame

├── editor_chaos.py           # Contains ChaoticSquareEditorFrame

├── editor_lua.py             # Contains LuaExplorerFrame & SyntaxPatterns

├── requirements.txt          # (empty by default)

└── assets/                   # (optional: icons, screenshots)
